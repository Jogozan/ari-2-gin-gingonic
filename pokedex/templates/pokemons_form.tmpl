{{ template "layout_head" . }}


<h1>{{ .title }}</h1>

<div id="errors" style="color:red;">
    {{ range .errors }}
        <div>{{ . }}</div>
    {{ end }}
</div>

<form id="pokemonForm">
    <div>
        <label>Nom :</label>
        <input type="text" id="name" value="{{ .input.Name }}">
        <div class="field-error" data-field="Name" style="color:red;"></div>
    </div>

    <div>
        <label>Base XP :</label>
        <input type="number" id="baseExperience" value="{{ .input.BaseExperience }}">
        <div class="field-error" data-field="BaseExperience" style="color:red;"></div>
    </div>

    <div>
        <label>Poids :</label>
        <input type="number" id="weight" value="{{ .input.Weight }}">
        <div class="field-error" data-field="Weight" style="color:red;"></div>
    </div>

    <div>
        <label>Taille :</label>
        <input type="number" id="height" value="{{ .input.Height }}">
        <div class="field-error" data-field="Height" style="color:red;"></div>
    </div>

    <div>
        <label>Types (séparés par des virgules) :</label>
        <input type="text" id="types" value="{{ join .input.Types "," }}">
        <div class="field-error" data-field="Types" style="color:red;"></div>
    </div>

    <fieldset>
        <legend>Stats</legend>
        <div>
            <label>HP :</label>
            <input type="number" id="hp" value="{{ .input.Stats.HP }}">
            <div class="field-error" data-field="Stats.HP" style="color:red;"></div>
        </div>
        <div>
            <label>Attaque :</label>
            <input type="number" id="attack" value="{{ .input.Stats.Attack }}">
            <div class="field-error" data-field="Stats.Attack" style="color:red;"></div>
        </div>
        <div>
            <label>Défense :</label>
            <input type="number" id="defense" value="{{ .input.Stats.Defense }}">
            <div class="field-error" data-field="Stats.Defense" style="color:red;"></div>
        </div>
        <div>
            <label>Vitesse :</label>
            <input type="number" id="speed" value="{{ .input.Stats.Speed }}">
            <div class="field-error" data-field="Stats.Speed" style="color:red;"></div>
        </div>
    </fieldset>

    <fieldset>
        <legend>Sprites</legend>
        <div>
            <label>Sprite avant (URL) :</label>
            <input type="text" id="front_default" value="{{ .input.Sprites.FrontDefault }}">
            <div class="field-error" data-field="Sprites.FrontDefault" style="color:red;"></div>
        </div>
        <div>
            <label>Sprite arrière (URL) :</label>
            <input type="text" id="back_default" value="{{ .input.Sprites.BackDefault }}">
            <div class="field-error" data-field="Sprites.BackDefault" style="color:red;"></div>
        </div>
    </fieldset>

    <button type="submit">Créer</button>
</form>

<pre id="result" style="margin-top:20px; background:#eee; padding:10px;"></pre>

<script>

document.getElementById("pokemonForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const payload = {
        name: document.getElementById("name").value,
        baseExperience: Number(document.getElementById("baseExperience").value),
        weight: Number(document.getElementById("weight").value),
        height: Number(document.getElementById("height").value),
        types: document.getElementById("types").value.split(",").map(t => t.trim()),
        stats: {
            hp: Number(document.getElementById("hp").value),
            attack: Number(document.getElementById("attack").value),
            defense: Number(document.getElementById("defense").value),
            speed: Number(document.getElementById("speed").value)
        },
        sprites: {
            front_default: document.getElementById("front_default").value,
            back_default: document.getElementById("back_default").value
        }
    };

    try {
        const res = await fetch("/pokemons", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (res.ok && res.status === 201) {
            const data = await res.json(); 
            // Récupère les données du Pokémon créé
            document.getElementById("result").textContent = `Pokémon créé avec succès.`;
            
            // Vider le formulaire
            document.getElementById("pokemonForm").reset();
            document.getElementById("errors").innerHTML = "";  // Masquer les erreurs précédentes
        } else if (res.status === 400 || res.status === 422) {
            const errorData = await res.json();
            document.getElementById("result").textContent = "Erreur de validation : " + errorData.message || "Données invalides";
        } else {
            throw new Error(`Erreur ${res.status}: ${res.statusText}`);
        }
    } catch (error) {
        console.error("Erreur:", error);
        document.getElementById("result").textContent = "Erreur lors de la création du Pokémon.";
    }
});

</script>

{{ template "layout_tail" . }}